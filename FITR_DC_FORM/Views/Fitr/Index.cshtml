
 
@model FITR_DC_FORM.Models.ViewModels.FitrViewModel

@{
    ViewData["Title"] = "FITR Form";
    string activeTab = ViewBag.ActiveTab ?? "basic";
}

<div class="container-fluid mt-3">
    <div class="row">

        <!-- FULL WIDTH PANEL -->
        <div class="col-12">
            <div class="card">

                <!-- HEADER -->
                <div class="card-header d-flex justify-content-between align-items-center">
                    <span>FITR DETAILS</span>

                    <div>
                        <!-- LIST BUTTON -->
                        <a asp-controller="Fitr"
                           asp-action="List"
                           class="btn btn-outline-primary btn-sm me-2">
                            📋 DC List
                        </a>

                        <!-- SAVE -->
                        @* <button type="button"
                                class="btn btn-primary btn-sm"
                                onclick="submitActiveForm()">
                            💾 Save
                        </button> *@

                        @if (Model?.Master?.FitrId > 0)
                        {
                            <a asp-action="Print"
                               asp-route-id="@Model.Master.FitrId"
                               target="_blank"
                               class="btn btn-secondary btn-sm ms-2">
                                🖨 Print
                            </a>
                        }
                    </div>
                </div>

                <!-- BODY -->
                <div class="card-body">

                    <!-- TABS (STEPPER) -->
                    @{
                        int maxStep = ViewBag.MaxAllowedStep ?? 1;
                        // Map tab names to steps
                        var tabs = new List<(string Id, string Label, int Step)>
                        {
                            ("basic", "Basic", 1),
                            ("product", "Product", 2),
                            ("material", "Material", 3),
                            ("sr", "Sr Data", 4),
                            ("visual", "Visual", 5),
                            ("final", "Final", 6)
                        };
                    }

                    <ul class="nav nav-tabs mb-3" style="border-bottom: 2px solid #dee2e6;">
                        @foreach (var t in tabs)
                        {
                            bool isLocked = t.Step > maxStep;
                            string isActive = activeTab == t.Id ? "active" : "";
                            string disabledClass = isLocked ? "disabled text-muted" : "";
                            
                            // Style for completed steps
                            string completedStyle = t.Step < maxStep ? "color: #198754; font-weight: 500;" : "";
                            
                            <li class="nav-item">
                                <a class="nav-link @isActive @disabledClass"
                                   data-bs-toggle="tab" href="#@t.Id"
                                   style="@(isActive != "" ? "font-weight:bold;" : "") @completedStyle @(isLocked ? "cursor: not-allowed; opacity: 0.6;" : "")">
                                    <span class="badge @(t.Step <= maxStep ? "bg-success" : "bg-secondary") rounded-pill me-1" 
                                          style="font-size: 0.7rem;">@t.Step</span>
                                    @t.Label
                                </a>
                            </li>
                        }
                    </ul>

                    <!-- TAB CONTENT -->
                    <div class="tab-content">
                        <div class="tab-pane fade @(activeTab == "basic" ? "show active" : "")" id="basic">
                            @await Html.PartialAsync("_Basic", Model)
                        </div>

                        <div class="tab-pane fade @(activeTab == "product" ? "show active" : "")" id="product">
                            @await Html.PartialAsync("_Product", Model)
                        </div>

                        <div class="tab-pane fade @(activeTab == "material" ? "show active" : "")" id="material">
                            @await Html.PartialAsync("_Material", Model)
                        </div>

                        <div class="tab-pane fade @(activeTab == "sr" ? "show active" : "")" id="sr">
                            @await Html.PartialAsync("_SrData", Model)
                        </div>

                        <div class="tab-pane fade @(activeTab == "visual" ? "show active" : "")" id="visual">
                            @await Html.PartialAsync("_Visual", Model)
                        </div>

                        <div class="tab-pane fade @(activeTab == "final" ? "show active" : "")" id="final">
                            @await Html.PartialAsync("_Final", Model)
                        </div>
                    </div>

                </div>

                <!-- BODY -->
                @* <div class="card-body">

                    <!-- BASIC -->
                    <div class="mb-4">
                        <h5 class="border-bottom pb-2">Basic Details</h5>
                        @await Html.PartialAsync("_Basic", Model)
                    </div>

                    <!-- PRODUCT -->
                    <div class="mb-4">
                        <h5 class="border-bottom pb-2">Product Details</h5>
                        @await Html.PartialAsync("_Product", Model)
                    </div>

                    <!-- MATERIAL -->
                    <div class="mb-4">
                        <h5 class="border-bottom pb-2">Material Details</h5>
                        @await Html.PartialAsync("_Material", Model)
                    </div>

                    <!-- SR DATA -->
                    <div class="mb-4">
                        <h5 class="border-bottom pb-2">Sr Data</h5>
                        @await Html.PartialAsync("_SrData", Model)
                    </div>

                    <!-- VISUAL -->
                    <div class="mb-4">
                        <h5 class="border-bottom pb-2">Visual</h5>
                        @await Html.PartialAsync("_Visual", Model)
                    </div>

                    <!-- FINAL -->
                    <div class="mb-4">
                        <h5 class="border-bottom pb-2">Final</h5>
                        @await Html.PartialAsync("_Final", Model)
                    </div>

                </div> *@

            </div>
        </div>

    </div>
</div>

<script src="~/js/fitr-validation.js"></script>
<script>
    function submitActiveForm() {
        const pane = document.querySelector(".tab-pane.show.active");
        const form = pane?.querySelector("form");
        if (form) form.submit();
        else alert("No form found in this tab.");
    }
</script>
